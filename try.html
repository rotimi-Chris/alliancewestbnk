<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
/* ===== Base Reset ===== */
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: #fff;
    margin: 0;
    padding: 0;
    color: #111;
}

/* ===== Container ===== */
.containerone {
    max-width: 450px;
    margin: 40px auto;
    padding: 20px;
}

/* ===== Balance Section ===== */
h1 {
    display: none; /* Hide default heading */
}

.info {
    text-align: center;
    margin-bottom: 30px;
    background: none;
    padding: 0;
}

#userBalance {
    font-size: 36px;
    font-weight: 700;
    display: block;
    margin: 10px 0;
}

.info p {
    font-size: 15px;
    margin: 6px 0;
    color: #444;
}

.info p strong {
    color: #666;
    font-weight: 600;
}

/* ===== Action Buttons (Add Cash, Cash Out style) ===== */
.btn-primary {
    background: #f4f4f4;
    color: #000;
    border: 1px solid #ddd;
    border-radius: 20px;
    font-size: 15px;
    padding: 10px;
    width: 45%;
    display: inline-block;
    margin: 10px 5px;
    font-weight: 600;
    transition: 0.2s;
}
.btn-primary:hover {
    background: #eaeaea;
}

.btn-secondary {
    background: #f4f4f4;
    color: #000;
    border: 1px solid #ddd;
    border-radius: 20px;
    font-size: 15px;
    padding: 10px;
    width: 45%;
    display: inline-block;
    margin: 10px 5px;
    font-weight: 600;
}
.btn-secondary:hover {
    background: #eaeaea;
}

/* ===== Profile Section ===== */
.profile {
    display: none; /* Hide top duplicate profile area */
}

.profile-pic-container {
    text-align: center;
    margin-bottom: 15px;
}
.profile-pic-container img {
    width: 60px;
    height: 60px;
    border-radius: 50%;
}

/* ===== Card Style Links ===== */
.option-card {
    display: flex;
    align-items: center;
    padding: 14px;
    border-bottom: 1px solid #eee;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
}
.option-card:hover {
    background: #f9f9f9;
}
.option-card img, 
.option-card i {
    width: 28px;
    height: 28px;
    margin-right: 15px;
}

/* ===== Logout Button ===== */
.logout-btn {
    margin-top: 30px;
    width: 100%;
    border: none;
    background: #f4f4f4;
    color: #000;
    padding: 12px;
    border-radius: 20px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: 0.2s;
}
.logout-btn:hover {
    background: #eaeaea;
}

/* ===== Modal Styling (unchanged, but polished) ===== */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0; top: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.5);
    justify-content: center;
    align-items: center;
}
.modal-content {
    background: white;
    padding: 25px;
    border-radius: 16px;
    width: 90%;
    max-width: 400px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    animation: fadeIn 0.3s ease-in-out;
}
.modal-content h3 {
    text-align: center;
    margin-bottom: 20px;
    color: #000;
}
.close-btn {
    float: right;
    cursor: pointer;
    font-size: 20px;
    color: #666;
}
</style>
<body>
    <div class="navbar">
        <div class="container">
            <a class="logo" href="#">Alliance West<span> Bank</span></a>
    
            <img id="mobile-cta" class="mobile-menu" src="/images/menu.svg" alt="Open Navigation">
    
            <nav>
                <img id="mobile-exit" class="mobile-menu-exit" src="/images/exit.svg" alt="Close Navigation">
    
                <ul class="primary-nav">
                    <li class="current"><a href="../index.html">Home</a></li>
                    <li><a href="#">Save</a></li>
                    <li><a href="/borrow/borrow.html">Borrow</a></li>
                    <li><a href="/about/about.html">About Us</a></li>
                </ul>
    
                <ul class="secondary-nav">
                    <li><a class="open-btn" onclick="openOverlay()" href="#">Log In</a></li>
    
                    <!-- Overlay -->
                    <div id="loginOverlay" class="overlay">
                        <div class="overlay-content">
                            <button class="close-btn" onclick="closeOverlay()">✖</button>
                            <h2 style="text-align: center;">Login</h2>
                            <form style="display: flex; flex-direction: column; align-items: center; width: 100%;">
                                <input type="text" placeholder="Account ID" required>
                                <input type="password" placeholder="Password" required>
                                <div style="margin-top: 20px;">
                                    <button style="border-radius: 40px;" type="submit" class="login-btn">Login</button>
                                </div>
                            </form>
                        </div>
                    </div>
    
                    
                </ul>
            </nav>
        </div>
    </div>
   <div class="containerone">
        <h1>User Dashboard</h1>

        <div class="profile">
            <img id="userImage" src="" alt="User Image">
            <h2 id="userName"></h2>
            <p id="userRole"></p>
        </div>

        <div class="info">
            <p><strong>Account Number:</strong> <span id="accountNumber"></span></p>
            <p><strong>Email:</strong> <span id="userEmail"></span></p>
            <p><strong>Phone:</strong> <span id="userPhone"></span></p>
            
            <p><strong>Balance:</strong> $<span id="userBalance"></span></p>
            <p><strong>Country:</strong> <span id="userCountry"></span></p>
            <p><strong>State:</strong> <span id="userState"></span></p>
            <p><strong>Address:</strong> <span id="userAddress"></span></p>
        </div>
        <div class="profile">
            <div class="profile-pic-container">
                <img id="userImage" src="" alt="User Image" width="100" height="100" style="border-radius: 50%;">
                <span class="edit-icon" id="editImageBtn">✏️</span>
            </div>
            <h2 id="userName"></h2>
            <p id="userRole"></p>
        </div>

        <button class="btn btn-primary" id="editProfileBtn">Edit Profile</button>

        <!-- Modal for editing profile -->
        <div class="modal" id="editModal">
            <div class="modal-content">
                <span class="close-btn" id="closeModal">&times;</span>
                <h3>Edit Profile</h3>
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" id="editName">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="editEmail">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="editPassword">
                </div>
                <div class="form-group">
                    <label>Address</label>
                    <input type="text" id="editAddress">
                </div>
                <button class="btn btn-primary" id="saveProfileBtn">Save Changes</button>
                <button class="btn btn-secondary" id="cancelEditBtn">Cancel</button>
            </div>
        </div>

        <button class="logout-btn" id="logoutBtn">Logout</button>
    </div>



    <script>
        // Get stored data from localStorage
        const accountData = localStorage.getItem("account");
        const accessToken = localStorage.getItem("accessToken");
        const refreshToken = localStorage.getItem("refreshToken");

        if (!accountData || !accessToken) {
            // No login info — redirect to login
            window.location.href = "login.html";
        } else {
            const account = JSON.parse(accountData);

            // Fill in user info
            document.getElementById("userImage").src = account.image || "https://via.placeholder.com/100";
            document.getElementById("userName").textContent = account.name;
            document.getElementById("userRole").textContent = account.role;
            document.getElementById("accountNumber").textContent = account.account_number;
            document.getElementById("userEmail").textContent = account.email;
            document.getElementById("userPhone").textContent = account.phone;
            document.getElementById("userAddress").textContent = account.address || "N/A";
            document.getElementById("userBalance").textContent = account.balance;
            document.getElementById("userCountry").textContent = account.country;
             document.getElementById("userState").textContent = account.state;

            // ✅ Role check: Add admin link if admin
            if (account.role && account.role.toLowerCase() === "admin") {
                const adminLink = document.createElement("a");
                adminLink.href = "getuser.html";
                adminLink.textContent = "Manage Users";
                adminLink.style.display = "block";
                adminLink.style.marginTop = "15px";
                adminLink.style.color = "#007bff";
                adminLink.style.fontWeight = "bold";
                document.querySelector(".container").appendChild(adminLink);
            }
        }

        // Logout button
        document.getElementById("logoutBtn").addEventListener("click", async () => {
            try {
                if (refreshToken) {
                    await fetch("https://bank-api-vqsk.onrender.com/account/logout", { // Change to your API URL
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ refreshToken })
                    });
                }

                // Clear stored tokens & user data
                localStorage.clear();

                // Redirect to home page
                window.location.href = "index.html";
            } catch (err) {
                console.error("Logout failed:", err);
                window.location.href = "login.html";
            }
        });
        const account = JSON.parse(localStorage.getItem("account") || "{}");
        // const accessToken = localStorage.getItem("accessToken");

        // Fill in data
        document.getElementById("userImage").src = account.image || "https://via.placeholder.com/100";
        document.getElementById("userName").textContent = account.name || "";
        document.getElementById("userRole").textContent = account.role || "";

        // Modal controls
        const modal = document.getElementById("editModal");
        document.getElementById("editProfileBtn").onclick = () => {
            document.getElementById("editName").value = account.name || "";
            document.getElementById("editEmail").value = account.email || "";
            document.getElementById("editPassword").value = "";
            document.getElementById("editAddress").value = account.address || "";
            modal.style.display = "flex";
        };
        document.getElementById("closeModal").onclick = () => modal.style.display = "none";
        document.getElementById("cancelEditBtn").onclick = () => modal.style.display = "none";
        window.onclick = e => { if (e.target == modal) modal.style.display = "none"; };

        // Save changes
        document.getElementById("saveProfileBtn").onclick = async () => {
            const updatedData = {
                name: document.getElementById("editName").value,
                email: document.getElementById("editEmail").value,
                password: document.getElementById("editPassword").value,
                address: document.getElementById("editAddress").value
            };

            try {
                const res = await fetch(`https://bank-api-vqsk.onrender.com/account/update/${account._id}`, {
                    method: "PATCH",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${accessToken}`
                    },
                    body: JSON.stringify(updatedData)
                });

                if (res.ok) {
                    const result = await res.json();
                    localStorage.setItem("account", JSON.stringify(result.data));
                    alert("Profile updated!");
                    window.location.reload();
                } else {
                    alert("Update failed");
                }
            } catch (err) {
                console.error(err);
                alert("Error updating profile");
            }
        };

        // Change image
        document.getElementById("editImageBtn").onclick = () => {
            const fileInput = document.createElement("input");
            fileInput.type = "file";
            fileInput.accept = "image/*";
            fileInput.onchange = async (e) => {
                const file = e.target.files[0];
                const formData = new FormData();
                formData.append("image", file);
                try {
                    const res = await fetch(`https://bank-api-vqsk.onrender.com/account/update/${account._id}`, {
                        method: "PATCH",
                        headers: { "Authorization": `Bearer ${accessToken}` },
                        body: formData
                    });
                    if (res.ok) {
                        const result = await res.json();
                        localStorage.setItem("account", JSON.stringify(result.data));
                        alert("Image updated!");
                        window.location.reload();
                    } else {
                        alert("Image update failed");
                    }
                } catch (err) {
                    console.error(err);
                    alert("Error uploading image");
                }
            };
            fileInput.click();
        };
        // Hide login & create account if user is already logged in
            window.addEventListener("DOMContentLoaded", () => {
                const accessToken = localStorage.getItem("accessToken");

                if (accessToken) {
                    // User is logged in → hide login + create account
                    const loginBtn = document.querySelector(".open-btn");
                    const createBtn = document.querySelector(".go-premium-cta");

                    if (loginBtn) loginBtn.style.display = "none";
                    if (createBtn) createBtn.style.display = "none";

                    // Optionally: add a logout button dynamically
                    const nav = document.querySelector(".secondary-nav");
                    if (nav && !document.getElementById("logoutBtn")) {
                        const li = document.createElement("li");
                        li.innerHTML = `<a href="#" id="logoutBtn">Logout</a>`;
                        nav.appendChild(li);

                        document.getElementById("logoutBtn").addEventListener("click", () => {
                            localStorage.removeItem("accessToken");
                            localStorage.removeItem("refreshToken");
                            localStorage.removeItem("account");
                            window.location.href = "/index.html"; // redirect after logout
                        });
                    }
                }
            });

    </script>

</body>
</html>